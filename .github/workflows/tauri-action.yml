name: "publish"
on: [push]

jobs:
  release:
    strategy:
      fail-fast: false
      matrix:
        platform: [macos-latest, ubuntu-latest, windows-latest]
    runs-on: ${{ matrix.platform }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Node.js setup
        uses: actions/setup-node@v1
        with:
          node-version: 16

      - name: Rust setup
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Install dependencies (ubuntu only)
        if: matrix.platform == 'ubuntu-latest'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev webkit2gtk-4.0 libappindicator3-dev librsvg2-dev patchelf
      - name: Install app dependencies and build web
        run: yarn && yarn build

      - name: Build the app
        uses: tauri-apps/tauri-action@v0
        
      - name: Push changes macos
        if: matrix.platform == 'macos-latest'
        run: |
        	git checkout -b macos
        	git add -A
        	git commit -m "builded"
        	git push origin macos
        
      - name: Push changes ubuntu
        if: matrix.platform == 'ubuntu-latest'
        run: |
        	git checkout -b ubuntu
        	git add -A
        	git commit -m "builded"
        	git push origin ubuntu
        
      - name: Push changes windows
        if: matrix.platform == 'windows-latest'
        run: |
        	git checkout -b windows
        	git add -A
        	git commit -m "builded"
        	git push origin windows


        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tagName: v__VERSION__ # tauri-action replaces \_\_VERSION\_\_ with the app version
          releaseName: 'v__VERSION__'
          releaseBody: 'See the assets to download this version and install.'
          releaseDraft: true
          prerelease: false

#jobs:
#  publish-tauri:
#    strategy:
#      fail-fast: false
#      matrix:
#        platform: [macos-latest, ubuntu-latest, windows-latest]

#    runs-on: ${{ matrix.platform }}
#    steps:
#    - uses: actions/checkout@v2
#    - name: setup node
#      uses: actions/setup-node@v1
#      with:
#        node-version: 16
#    - name: install Rust stable
#      uses: actions-rs/toolchain@v1
#      with:
#        toolchain: stable
#    - name: install dependencies (ubuntu only)
#      if: matrix.platform == 'ubuntu-latest'
#      run: |
#        sudo apt-get update
#        sudo apt-get install -y libgtk-3-dev webkit2gtk-4.0 libappindicator3-dev librsvg2-dev patchelf
#    - name: install app dependencies and build it
#      run: yarn && yarn build
#    - uses: tauri-apps/tauri-action@v0
#      env:
#        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#      with:
#        tagName: app-v__VERSION__  the action automatically replaces \_\_VERSION\_\_ with the app version
#        releaseName: "App v__VERSION__"
#        releaseBody: "See the assets to download this version and install."
#        releaseDraft: true
#        prerelease: false
